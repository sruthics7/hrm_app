{% extends 'base.html' %}
{% load static %}
{% block title %}HRM - Payroll{% endblock %}
{% block content %}
<div
    class="md:max-w-auto min-h-screen min-w-0 max-w-full flex-1 rounded-[30px] bg-slate-100 px-4 pb-10 dark:bg-darkmode-700 md:px-[22px]">

    <!-- Header -->
    <div class="mt-5 grid grid-cols-12 gap-6">
        <div class="intro-y col-span-12 mt-2 flex flex-wrap items-center sm:flex-nowrap">
            <div class="mx-auto hidden text-slate-500 md:block">Showing {{ employees.count }} employees</div>

            <div class="mt-3 w-full sm:ml-auto sm:mt-0 sm:w-auto md:ml-0">
                <div class="relative w-56 text-slate-500">
                    <input type="text" id="searchInput" placeholder="Search employees..."
                        class="text-sm border-slate-200 shadow-sm rounded-md w-56 pr-10 focus:ring-4 focus:ring-primary dark:bg-darkmode-800 dark:border-transparent dark:focus:ring-slate-700 placeholder:text-slate-400" />
                    <i data-lucide="search" class="stroke-1.5 absolute inset-y-0 right-0 my-auto mr-3 h-4 w-4"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Heading -->
    <h2 class="intro-y mt-10 text-lg font-medium">Employee Payroll Details</h2>

    <!-- Payroll Table -->
    <div class="grid grid-cols-12 gap-6">
        <div class="intro-y col-span-12 overflow-auto">
            <table class="table-auto w-full border-collapse text-sm text-left" id="employeeTable">
                <thead>
                    <tr class="bg-gray-200 dark:bg-darkmode-600">
                        <th class="p-2">S.No</th>
                        <th class="p-2">Employee ID</th>
                        <th class="p-2">Employee Name</th>
                        <th class="p-2">Designation</th>
                        <th class="p-2">Department</th>
                        <th class="p-2 text-right">Basic Salary (₹)</th>
                        <th class="p-2 text-right">Bonus (₹)</th>
                        <th class="p-2 text-right">Deductions (₹)</th>
                        <th class="p-2 text-right">Total Salary (₹)</th>
                        <th class="p-2 text-center">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for employee in employees %}
                    <tr class="border-t employee-row">
                        <td class="p-2">{{ forloop.counter|stringformat:"02d" }}</td>
                        <td class="p-2 employee-id">#Xev{{ employee.id }}</td>
                        <td class="p-2 employee-name">{{ employee.full_name }}</td>
                        <td class="p-2 employee-designation">{{ employee.designation }}</td>
                        <td class="p-2 employee-department">{{ employee.department }}</td>
                        <td class="p-2 text-right">{{ employee.basic_salary|floatformat:2 }}</td>
                        <td class="p-2 text-right">{{ employee.bonus|floatformat:2 }}</td>
                        <td class="p-2 text-right">{{ employee.deductions|floatformat:2 }}</td>
                        <td class="p-2 text-right font-semibold text-green-600">
                            {{ employee.total_salary|floatformat:2 }}
                        </td>
                        <td class="p-2 text-center"><span class="status active">Paid</span></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="10" class="text-center p-4">No payroll records found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="flex justify-between items-center mt-6 text-sm">
        <div id="entriesCount">Showing <span id="visibleCount">{{ employees.count }}</span> of {{ employees.count }}
            Entries</div>
        <div id="noResults" class="hidden text-red-500">No employees match your search</div>
    </div>
</div>

<!-- Search Function -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('searchInput');
        const employeeRows = document.querySelectorAll('.employee-row');
        const visibleCountSpan = document.getElementById('visibleCount');
        const noResultsDiv = document.getElementById('noResults');
        const entriesCountDiv = document.getElementById('entriesCount');
        const totalEmployees = {{ employees.count }
    };

    if (searchInput) {
        searchInput.addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase().trim();
            let visibleCount = 0;

            employeeRows.forEach(function (row) {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            visibleCountSpan.textContent = visibleCount;

            if (visibleCount === 0 && searchTerm !== '') {
                noResultsDiv.classList.remove('hidden');
                entriesCountDiv.classList.add('hidden');
            } else {
                noResultsDiv.classList.add('hidden');
                entriesCountDiv.classList.remove('hidden');
            }
        });
    }
});
</script>

<!-- Styles -->
<style>
    .status.active {
        background-color: #10b981;
        color: white;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
    }

    .employee-row:hover {
        background-color: rgba(59, 130, 246, 0.05);
    }

    #searchInput:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
</style>
{% endblock %}
{% extends 'base.html' %} 
{% load static %}
 {% block title %}HRM-DASHBOARD{% endblock %} 
 {% block content %}
<body>
  <!-- BEGIN: Leave Tracker -->
  <div class="leave-tracker">
    {% if usergroup == "Admin" or usergroup == "Super Admin" %}
    <!-- Admin & Super Admin Section -->
    <h2>Leave Requests ({{ usergroup }})</h2>

    <form method="post">
      {% csrf_token %}
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Type</th>
            <th>From</th>
            <th>To</th>
            <th>Days</th>
            <th>Reason for Leave</th>
            <!-- ✅ Employee's reason -->
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for leave in leave_history %}
          <tr>
            <td>{{ leave.user.username }}</td>
            <td>{{ leave.get_leave_type_display }}</td>
            <td>{{ leave.start_date }}</td>
            <td>{{ leave.end_date }}</td>
            <td>{{ leave.days }}</td>
            <td>{{ leave.reason|default:"-" }}</td>
            <!-- ✅ shows reason for leave -->
            <td
              class="{% if leave.status == 'Approved' %}approved{% elif leave.status == 'Rejected' %}rejected{% else %}pending{% endif %}"
            >
              {{ leave.status }}
            </td>
            <td>
              {% if leave.status == "Pending" %}
              <input type="hidden" name="leave_id" value="{{ leave.id }}" />
              <div class="action-buttons">
                <button name="action" value="approve" class="btn-approve">
                  Approve
                </button>
                <button name="action" value="reject" class="btn-reject">
                  Reject
                </button>
              </div>
              {% else %} {{ leave.status }} {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8">No leave requests found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </form>

    {% else %}
    <!-- Employee Section -->

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="card blue">
        <h4>Total Leaves</h4>
        <p>{{ total_leaves }}</p>
      </div>
      <div class="card blue">
        <h4>Taken</h4>
        <p>{{ taken_leaves }}</p>
      </div>
      <div class="card blue">
        <h4>Remaining</h4>
        <p>{{ remaining_leaves }}</p>
      </div>
    </div>

    <!-- Leave Form -->
    <div class="leave-form">
      <h3>Apply for Leave</h3>
      <form method="post" action="{% url 'leavetracker' %}">
        {% csrf_token %}
        <div class="form-grid">
          <div class="form-group">
            <label for="leave_type">Leave Type</label>
            <select name="leave_type" id="leave_type" required>
              {% for code, name in leave_type_choices %}
              <option value="{{ code }}">{{ name }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="form-group">
            <label for="start_date">From</label>
            <input
              type="date"
              id="start_date"
              name="start_date"
              min="{{ today|date:'Y-m-d' }}"
              required
            />
          </div>

          <div class="form-group">
            <label for="end_date">To</label>
            <input
              type="date"
              id="end_date"
              name="end_date"
              min="{{ today|date:'Y-m-d' }}"
              required
            />
          </div>

          <div class="form-group">
            <label for="reason">Reason</label>
            <input
              type="text"
              id="reason"
              name="reason"
              placeholder="Optional"
            />
          </div>
        </div>
        <button type="submit">Apply Leave</button>
      </form>
    </div>

    <!-- History Table -->
    <div class="leave-history">
      <h3>Leave History</h3>
      <table>
        <thead>
          <tr>
            <th>Type</th>
            <th>From</th>
            <th>To</th>
            <th>Days</th>
            <th>Status</th>
            <th>Reason</th>
          </tr>
        </thead>
        <tbody>
          {% for leave in leave_history %}
          <tr>
            <td>{{ leave.get_leave_type_display }}</td>
            <td>{{ leave.start_date }}</td>
            <td>{{ leave.end_date }}</td>
            <td>{{ leave.days }}</td>
            <td
              class="{% if leave.status == 'Approved' %}approved{% elif leave.status == 'Rejected' %}rejected{% else %}pending{% endif %}"
            >
              {{ leave.status }}
            </td>
            <td>{{ leave.reason|default:"-" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6">No leave history found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% endif %}
  </div>
  <!-- END: Leave Tracker -->
</body>

<style>
  .leave-tracker {
    padding: 20px;
  }
  .summary-cards {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
  }
  .card {
    flex: 1;
    background-color: #2563eb;
    color: white;
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }
  .leave-form {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }
  button {
    background-color: #2563eb;
    color: white;
    padding: 8px 18px;
    border: none;
    border-radius: 8px;
    margin-top: 10px;
    cursor: pointer;
  }
  .leave-history table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }
  .leave-history th,
  .leave-history td {
    padding: 10px;
    border-bottom: 1px solid #eee;
    text-align: center;
  }
  textarea {
    width: 100%;
    border-radius: 6px;
    padding: 5px;
    resize: none;
  }
  .approved {
    color: #10b981;
    font-weight: 600;
  }
  .rejected {
    color: #ef4444;
    font-weight: 600;
  }
  .pending {
    color: #f59e0b;
    font-weight: 600;
  }
  .btn-approve {
    background: #10b981;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 6px;
  }
  .btn-reject {
    background: #ef4444;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 6px;
  }
  .action-buttons {
    display: flex;
    gap: 5px;
    margin-top: 5px;
    justify-content: center;
  }
</style>

{% endblock %}
